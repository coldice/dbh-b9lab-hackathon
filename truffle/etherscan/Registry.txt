pragma solidity ^0.4.5;

contract Registry {
    struct Info {
        bytes32 name;
        string location;
    }
    mapping (address => Info) public infos;
    mapping (bytes32 => address) public addresses;

    event LogInfoChanged(address indexed who, bytes32 indexed name, string location);

    function setInfo(bytes32 name, string location) returns (bool successful) {
        if (name != 0 // It is ok to set your name back to empty string
            && addresses[name] != 0 // It is taken for real
            && addresses[name] != msg.sender) { // This name is given to someone else
            // Already taken
            throw;
        }
        if (infos[msg.sender].name != "") { // If the sender had previously set a name
            addresses[infos[msg.sender].name] = 0; // His former name will map to 0
        }
        infos[msg.sender].name = name;
        infos[msg.sender].location = location;
        if (name != 0) {
            addresses[name] = msg.sender;
        }
        LogInfoChanged(msg.sender, name, location);
        return true;
    }
}

address: 0x4720d45bfd15d1861a2e4631fc35ca2e9d76c015
compiler: 0.4.8
optimisation: true